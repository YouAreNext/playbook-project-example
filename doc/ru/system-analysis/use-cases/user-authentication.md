# Use Case Specification

## 1) Идентификатор и атрибуты
- **ID:** UC-AUTH
- **Название:** Аутентификация пользователя
- **Версия:** 1.0
- **Приоритет:** High
- **Владелец:** Product Team
- **Статус:** Draft

## 2) Краткое описание
Сценарий описывает, как новый или существующий пользователь может войти в систему "Localize" с использованием своего email и пароля или через провайдера Google. Это позволяет системе персонализировать опыт и сохранять маршруты пользователя.

## 3) Область применения и границы
- **Входит:** Регистрация по Email/паролю, вход по Email/паролю, вход/регистрация через Google (OAuth), выход из системы.
- **Исключено (Out of Scope):** Восстановление пароля, смена пароля, двухфакторная аутентификация.

## 4) Акторы (Actors)
- **Пользователь** (основной): Инициирует все действия.
- **Система "Localize"** (вторичной): Обрабатывает запросы, управляет сессиями.
- **Google** (внешний сервис): Провайдер аутентификации через OAuth 2.0.

## 5) Предусловия (Preconditions)
- Пользователь имеет доступ к приложению "Localize" через веб-браузер.

## 6) Триггер и частота
- **Триггер:** Пользователь нажимает на кнопку "Войти", "Зарегистрироваться" или "Войти через Google".
- **Частота:** Высокая, при каждом новом сеансе работы с приложением.

## 7) Основной успешный сценарий (Main Success Scenario)

| # | Актор | Действие / Ответ | Состояние/Данные/Статусы |
|---|---|---|---|
| 1 | Пользователь | Выбирает способ входа/регистрации. | - |
| 2 | Пользователь | **(Если Email/Пароль)** Вводит email и пароль, нажимает "Продолжить". | - |
| 3 | Система | Валидирует данные. Создает новую запись пользователя (при регистрации) или находит существующую. Генерирует пару JWT токенов (access, refresh). | Статус пользователя: `ACTIVE`. В БД: создана/найдена запись `users`. |
| 4 | Система | Отправляет токены клиенту и перенаправляет на главный экран. | Пользователь аутентифицирован. |
| 5 | Пользователь | **(Если Google)** Нажимает "Войти через Google". | - |
| 6 | Система | Перенаправляет пользователя на страницу аутентификации Google. | - |
| 7 | Google | Аутентифицирует пользователя и запрашивает его согласие на передачу данных. | - |
| 8 | Google | Перенаправляет пользователя обратно в приложение с кодом авторизации. | - |
| 9 | Система | Получает код, обменивает его на токен доступа Google, запрашивает данные пользователя. Находит или создает пользователя в БД. Генерирует пару JWT токенов. | Статус пользователя: `ACTIVE`. В БД: создана/найдена запись `users`. |
| 10| Система | Отправляет токены клиенту и перенаправляет на главный экран. | Пользователь аутентифицирован. |
| 11| Пользователь | Нажимает "Выйти". | - |
| 12| Система | Удаляет сессию пользователя (например, инвалидирует refresh токен) и перенаправляет на страницу входа. | Пользователь не аутентифицирован. |

## 8) Альтернативные потоки и исключения (Extensions)
- **E2.a (Неверный формат email/пароля):** Система отображает ошибку валидации под полем.
- **E3.a (Пользователь уже существует):** При регистрации система предлагает войти.
- **E3.b (Пользователь не найден):** При входе система отображает ошибку "Неверные учетные данные".
- **E8.a (Ошибка Google OAuth):** Система отображает сообщение об ошибке.

## 9) Постусловия (Postconditions)
- **Успех:** Пользователь аутентифицирован в системе и имеет активную сессию.
- **Неудача:** Пользователь остается неаутентифицированным.

## 10) Бизнес-правила и ограничения
- Пароль должен соответствовать политикам безопасности (длина, символы). **[OPEN QUESTION]** Каковы точные политики?

## 14) Трассируемость требований (Traceability)
| RQ-ID | Покрывающие шаги UC |
|---|---|
| FR-01 | 2, 3, 5-10, 11, 12 |

## 16) Открытые вопросы (Open Questions)
- **[OPEN QUESTION]** Каковы точные политики безопасности для пароля (минимальная длина, требуемые символы)?